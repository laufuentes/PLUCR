readRDS("6000_results_Null-Linear/Theta_opt/3_recommendations.rds")
theta_corr <- readRDS("3000_results_Null-Linear/Theta_opt/1_0.1_5.rds")
visual_treatment_plot()
n<- 1e4
ncov<- 10L
scenario_mu <- "Null"
scenario_nu <- "Linear"
exp <- generate_data(n, ncov, scenario_mu, scenario_nu)
df_obs<- exp[[2]]
delta_mu <- exp[[3]]
delta_nu <- exp[[4]]
X <- df_obs %>%
dplyr::select(starts_with("X."))%>%
as.matrix()
A <- df_obs$Treatment
Y <- df_obs$Y
Xi <- df_obs$Xi
root.path_3000 <- paste0(3000, "_results_", scenario_mu, "-", scenario_nu)
root.path_3000
theta_3000 <- file.path(root.path_3000, "Theta_opt",
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = paste0("^_\\d+_\\d+")))
theta_3000
setwd("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results")
theta_3000
theta_3000 <- file.path(root.path_3000, "Theta_opt",
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = paste0("^_\\d+_\\d+")))
theta_3ยง
theta_3000
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = paste0("^_\d+_\d+"))
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = paste0("^_\\d+"))
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = "^_\\d+")
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = "^\\d+_\\d+")
files_3000_corr <- file.path(root.path_3000, "Theta_opt",
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = paste0("^\\d+_\\d+")))
files_3000_oracular <- file.path(root.path_3000, "Theta_opt",
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = paste0("^\\d+_O")))
psi_3000_corr <- lapply(files_3000_corr, function(f){make_psi(readRDS(f))(X)})
psi_3000_oracular <- lapply(files_3000_oracular, function(f){make_psi(readRDS(f))(X)})
psi_3000_corr
str(psi_3000_corr)
sigma_psi_3000_corr  <- rowMeans(do.call(cbind, psi_3000_corr))
sigma_psi_3000_oracular <- rowMeans(do.call(cbind, psi_3000_oracular))
exp
visual_treatment_plot(mean_psi_3000_corr, lambda = NULL, beta=NULL, centered = FALSE, Var_X_axis = X[,1], Var_Y_axis = X[,2])
visual_treatment_plot(mean_psi_3000_corr, lambda = 0, beta=0, centered = FALSE, Var_X_axis = X[,1], Var_Y_axis = X[,2])
mean_psi_3000_corr  <- rowMeans(do.call(cbind, psi_3000_corr))
visual_treatment_plot(mean_psi_3000_corr, lambda = 0, beta=0, centered = FALSE, Var_X_axis = X[,1], Var_Y_axis = X[,2])
visual_treatment_plot(mean_psi_3000_corr, lambda = 0, beta=0, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "")
visual_treatment_plot(mean_psi_3000_corr, lambda = 0, beta=0, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "")
isual_treatment_plot(mean_psi_3000_corr, lambda = 0, beta=0, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "",
name=paste0(scenario_mu, "-", scenario_nu))
visual_treatment_plot(mean_psi_3000_corr, lambda = 0, beta=0, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "",
name=paste0(scenario_mu, "-", scenario_nu))
visual_treatment_plot(mean_psi_3000_corr, lambda = 0, beta=0, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "Images",
name=paste0("Mean_corr", scenario_mu, "-", scenario_nu))
mean_psi_3000_oracular <- rowMeans(do.call(cbind, psi_3000_oracular))
visual_treatment_plot(mean_psi_3000_oracular, lambda = 0, beta=0, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "Images",
name=paste0("Mean_or", scenario_mu, "-", scenario_nu))
mean_psi_3000_oracular
visual_treatment_plot
readRDS(files_3000_corr[[1]])
readRDS(files_3000_oracular[[1]])
visual_treatment_plot(mean_psi_3000_corr, lambda = 5, beta=0.1, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "Images",
name=paste0("Mean_corr", scenario_mu, "-", scenario_nu))
files_3000_oracular <- file.path(root.path_3000, "Theta_opt",
list.files(file.path(root.path_3000, "Theta_opt"),
pattern = paste0("^\\d+_O")))
psi_3000_oracular <- lapply(files_3000_oracular, function(f){make_psi(readRDS(f))(X)})
mean_psi_3000_oracular <- rowMeans(do.call(cbind, psi_3000_oracular))
visual_treatment_plot(mean_psi_3000_oracular, lambda = 4, beta=0.25, centered = FALSE,
Var_X_axis = X[,1], Var_Y_axis = X[,2], root.path = "Images",
name=paste0("Mean_or", scenario_mu, "-", scenario_nu))
visual_treatment_plot
psi_3000_corr <- lapply(files_3000_corr, function(f){
theta<- readRDS(f)
lambda <- attr(theta, "lambda")
beta <- attr(theta, "beta")
sigma_beta(make_psi(theta)(X), beta=beta)})
mean_psi_3000_corr  <- rowMeans(do.call(cbind, psi_3000_corr))
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = mean_psi_3000_corr)
exp
Var_X_axis <- attr(delta_mu,"vars")[1]
Var_Y_axis <- attr(delta_mu,"vars")[2]
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = mean_psi_3000_corr)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) + ggplot2::labs(title = bquote(lambda ==
.(lambda) ~ "," ~ beta == .(beta)), color = "Treatment\nProbability") +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = mean_psi_3000_corr)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
Var_X_axis
Var_X_axis <- X[,attr(delta_mu,"vars")[1]]
Var_Y_axis <- X[,attr(delta_mu,"vars")[2]]
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = mean_psi_3000_corr)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
mean_psi_3000_oracular <- rowMeans(do.call(cbind, psi_3000_oracular))
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = mean_psi_3000_oracular)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
psi_3000_oracular <- lapply(files_3000_oracular, function(f){
theta<- readRDS(f)
lambda <- attr(theta, "lambda")
beta <- attr(theta, "beta")
sigma_beta(make_psi(theta)(X), beta=beta)})
mean_psi_3000_oracular <- rowMeans(do.call(cbind, psi_3000_oracular))
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = mean_psi_3000_oracular)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
ggsave(paste0("Mean_sigma_beta_oracular", scenario_mu, "-", scenario_nu,".pdf"))
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = mean_psi_3000_corr)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
ggsave(paste0("Mean_sigma_beta_corr", scenario_mu, "-", scenario_nu,".pdf"))
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/Images/visualize_treatment_proba.R")
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/Images/visualize_treatment_proba.R")
readRDS("18000_results_Null-Satisfied/Binary/1_binary_policies.rds")
readRDS("18000_results_Null-Satisfied/Theta_opt/1_recommendations.rds")
readRDS("18000_results_Null-Satisfied/Theta_opt/1_recommendations.rds") %>% colnames()
readRDS("18000_results_Null-Satisfied/Theta_opt/1_recommendations.rds") %>% boxplot()
readRDS("6000_results_Null-Satisfied/Theta_opt/1_recommendations.rds") %>% boxplot()
readRDS("3000_results_Null-Satisfied/Theta_opt/1_recommendations.rds") %>% boxplot()
readRDS("3000_results_Null-Satisfied/Binary/1_binary_policies.rds") %>% boxplot()
readRDS("3000_results_Null-Satisfied/Binary/2_binary_policies.rds") %>% boxplot()
readRDS("3000_results_Null-Satisfied/Theta_opt/2_recommendations.rds") %>% boxplot()
readRDS("6000_results_Constant-Satisfied/Theta_opt/1_recommendations.rds") %>% boxplot()
readRDS("6000_results_Constant-Satisfied/Binary/1_binary_policies.rds") %>% boxplot()
bin < readRDS("3000_results_Null-Linear/Binary/1_binary_policies.rds")[,4]
bin <- readRDS("3000_results_Null-Linear/Binary/1_binary_policies.rds")[,4]
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = bin)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
df_complete <- readRDS("3000_results_Null-Linear/Df/1_df.rds")
bin <- readRDS("3000_results_Null-Linear/Binary/1_binary_policies.rds")[,4]
X <- df_complete %>%
dplyr::select(starts_with("X."))%>%
as.matrix()
Var_X_axis <- X[,attr(delta_mu,"vars")[1]]
Var_Y_axis <- X[,attr(delta_mu,"vars")[2]]
df <- data.frame(x = Var_X_axis, y = Var_Y_axis, treat_proba = bin)
ggplot2::ggplot(df, ggplot2::aes(x = x, y = y, color = treat_proba)) +
ggplot2::geom_point(alpha = 1) + ggplot2::scale_color_viridis_c(option = "magma",
limits = c(0, 1), oob = scales::squish) +
ggplot2::theme_minimal() + ggplot2::theme(legend.position = "right")
setwd("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/PLUCR_package")
devtools::document("PLUCR/")
devtools::build("PLUCR/")
devtools::install("PLUCR/")
setwd("~/")
i<- 1
`%>%`<- magrittr::`%>%`
library(SuperLearner)
library(PLUCR)
library(grf)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(patchwork)
library(quadprog)
library(caret)
source("backup_MC_simu.R")
i<- 1
`%>%`<- magrittr::`%>%`
library(SuperLearner)
library(PLUCR)
library(grf)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(patchwork)
library(quadprog)
library(caret)
source("Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/backup_MC_simu.R")
n <-6*1e2 # number of individuals
JFold <- 3L # Number of folds
Lambdas <- seq(1,15,by=1) # Lambda candidates
B <- c(0.05, 0.1, 0.25, 0.5) # Beta candidates
alpha <- 0.1 # constraint tolerance
precision <- 0.025 # Frank-Wolfe desired precision
centered <- FALSE
SL.library <- c(
"SL.mean",        # Simple baseline
"SL.glm",
"SL.ranger",      # Fast implementation of Random Forest
"SL.grf",
"SL.xgboost")
tol <- 0.025
max_iter <- 5
ncov <- 5L
scenario_mu <- "Linear"
scenario_nu <- "Linear"
is_RCT <- TRUE
root.path <- paste0(n, "_results_", scenario_mu, "-", scenario_nu)
exp <- PLUCR::generate_data(n, ncov, scenario_mu, scenario_nu) # changer scenario score de propension expit(-0.5*X3 + 0.5*1(X1>0.3))
df_complete <- exp[[1]]
# Observational data
df_obs <- exp[[2]]
X <- df_obs %>%
dplyr::select(starts_with("X."))%>%
as.matrix()
A <- df_obs$Treatment
Y <- df_obs$Y
Xi <- df_obs$Xi
delta_mu <- exp[[3]]
delta_nu <- exp[[4]]
output <- mc_main_algorithm(X=X, A=A, Y=Y, Xi=Xi,
Lambdas=Lambdas, alpha=alpha, precision=precision,
B=B, centered=centered, SL.library=SL.library,
tol=tol, max_iter=max_iter, root.path=root.path, iteration=i)
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/backup_MC_simu.R")
setwd("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results")
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/Images/Figures article /PCD.R")
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/Images/Figures article /Mean_treatment_proba.R")
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/Images/Figures article /Mean_treatment_proba.R")
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/Images/Figures article /Mean_treatment_proba.R")
source("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/MC results/Images/Figures article /Mean_treatment_proba.R")
`%>%`<- magrittr::`%>%`
library(SuperLearner)
library(PLUCR)
library(grf)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)
library(patchwork)
source("Images/Figures article /fcts.R")
scenario_mu <- "Linear"
scenario_nu <- "Linear"
alpha <- 0.1
y_min <- 0.525
y_max <- 0.56
c_min <- -0.125
c_max <- -0.0525
root.path_3000 <- paste0(3*1e3,"_results_", scenario_mu,"-",scenario_nu)
folder_3000 <- file.path(root.path_3000, "MC_metrics")
all_files_3000 <- file.path(root.path_3000, "MC_metrics", list.files(folder_3000))
root.path_6000 <- paste0(6*1e3,"_results_", scenario_mu,"-",scenario_nu)
folder_6000 <- file.path(root.path_6000, "MC_metrics")
all_files_6000 <- file.path(root.path_6000, "MC_metrics", list.files(folder_6000))
policy_value_data_3000 <- tibble(
"Oracle-PLUCR" = extract_results_proba(1, policy_value, all_files_3000),
"Naive-PLUCR" = extract_results_proba(2, policy_value, all_files_3000),
"PLUCR" = extract_results_proba(3, policy_value, all_files_3000),
"Size" = rep(3000, length(all_files_3000))
)
policy_value_data_6000 <- tibble(
"Oracle-PLUCR" = extract_results_proba(1, policy_value, all_files_6000),
"Naive-PLUCR" = extract_results_proba(2, policy_value, all_files_6000),
"PLUCR" = extract_results_proba(3, policy_value, all_files_6000),
"Size" = rep(6000, length(all_files_6000))
)
policy_value_data <- bind_rows(policy_value_data_3000, policy_value_data_6000)
policy_value_long <- policy_value_data %>%
pivot_longer(cols = colnames(policy_value_data)[colnames(policy_value_data)!="Size"],
names_to = "Method",
values_to = "policy")%>%
mutate(Method=factor(Method, levels = c("Oracle-PLUCR", "Naive-PLUCR","PLUCR")))
ref_val_policy <- policy_value_data %>% select(-"Size")
plot_policy_value <- ggplot(policy_value_long, aes(x = factor(Size), y = policy, fill = Method)) +
geom_violin(alpha = 0.4, color = NA, trim = FALSE, scale = "width",
position = position_dodge(width = 0.9)) +   # smooth violin with fill
geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.9)) +  # narrow box inside
labs(#title = "Policy value by sample size and method",
x = "Sample size (n)",
y = "Policy values") +
coord_cartesian(ylim = c(y_min, y_max))+
theme_minimal()
plot_policy_value
y_min <- 0.54
y_max <- 0.65
c_min <- -0.125
c_max <- -0.0525
policy_value_long <- policy_value_data %>%
pivot_longer(cols = colnames(policy_value_data)[colnames(policy_value_data)!="Size"],
names_to = "Method",
values_to = "policy")%>%
mutate(Method=factor(Method, levels = c("Oracle-PLUCR", "Naive-PLUCR","PLUCR")))
ref_val_policy <- policy_value_data %>% select(-"Size")
plot_policy_value <- ggplot(policy_value_long, aes(x = factor(Size), y = policy, fill = Method)) +
geom_violin(alpha = 0.4, color = NA, trim = FALSE, scale = "width",
position = position_dodge(width = 0.9)) +   # smooth violin with fill
geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.9)) +  # narrow box inside
labs(#title = "Policy value by sample size and method",
x = "Sample size (n)",
y = "Policy values") +
coord_cartesian(ylim = c(y_min, y_max))+
theme_minimal()
plot_policy_value
constraint_data_3000 <- tibble(
"Oracle-PLUCR" = extract_results_proba(1, constraint, all_files_3000),
"Naive-PLUCR" = extract_results_proba(2, constraint, all_files_3000),
"PLUCR" = extract_results_proba(3, constraint, all_files_3000),
"Size" = rep(3000, length(all_files_3000))
)
constraint_data_6000 <- tibble(
"Oracle-PLUCR" = extract_results_proba(1, constraint, all_files_6000),
"Naive-PLUCR" = extract_results_proba(2, constraint, all_files_6000),
"PLUCR" = extract_results_proba(3, constraint, all_files_6000),
"Size" = rep(6000, length(all_files_6000))
)
constraint_data <- bind_rows(constraint_data_3000, constraint_data_6000)
constraint_long <- constraint_data %>%
pivot_longer(cols = colnames(constraint_data)[colnames(constraint_data)!="Size"],
names_to = "Method",
values_to = "constraint")%>%
mutate(Method=factor(Method, levels = c("Oracle-PLUCR", "Naive-PLUCR","PLUCR")))%>%
group_by(Size, Method) %>%
mutate(var_val = var(constraint, na.rm = TRUE)) %>%
ungroup()
ref_val_constraint <- constraint_data %>% select(-"Size")
plot_constraint <- ggplot(constraint_long, aes(x = factor(Size), y = constraint, fill = Method)) +
geom_violin(data = subset(constraint_long, var_val > 0),
scale = "width",
alpha = 0.4, color = NA, trim = FALSE,
position = position_dodge(width = 0.8)) +
geom_boxplot(aes(group = interaction(Size, Method)),
width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.8)) +
labs(#title = "Constraint values",
x = "Sample size (n)",
y = "Constraint values") +
coord_cartesian(ylim = c(c_min, c_max))+
theme_minimal()
plot_constraint
c_min <- -0.07
c_max <- 0.1
constraint_long <- constraint_data %>%
pivot_longer(cols = colnames(constraint_data)[colnames(constraint_data)!="Size"],
names_to = "Method",
values_to = "constraint")%>%
mutate(Method=factor(Method, levels = c("Oracle-PLUCR", "Naive-PLUCR","PLUCR")))%>%
group_by(Size, Method) %>%
mutate(var_val = var(constraint, na.rm = TRUE)) %>%
ungroup()
ref_val_constraint <- constraint_data %>% select(-"Size")
plot_constraint <- ggplot(constraint_long, aes(x = factor(Size), y = constraint, fill = Method)) +
geom_violin(data = subset(constraint_long, var_val > 0),
scale = "width",
alpha = 0.4, color = NA, trim = FALSE,
position = position_dodge(width = 0.8)) +
geom_boxplot(aes(group = interaction(Size, Method)),
width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.8)) +
labs(#title = "Constraint values",
x = "Sample size (n)",
y = "Constraint values") +
coord_cartesian(ylim = c(c_min, c_max))+
theme_minimal()
plot_constraint
root.path_3000 <- paste0(3*1e3,"_results_", scenario_mu,"-",scenario_nu)
folder_3000 <- file.path(root.path_3000, "Binary")
all_files_3000 <- file.path(root.path_3000, "Binary",list.files(folder_3000, pattern="^\\d+_ev"))
exp<- generate_data(1e4, 10, scenario_mu, scenario_nu)
df_complete <- exp[[1]]
delta_mu <- exp[[3]]
delta_nu <- exp[[4]]
X <- df_complete %>%
dplyr::select(starts_with("X."))%>%
as.matrix()
Y.1 <- df_complete$Y.1
Y.0 <- df_complete$Y.0
synthetic_data_plot(delta_mu, delta_nu, root.path = "Images/Figures article /Images/Synthetic-data-plot/", name=paste0(scenario_mu, "-", scenario_nu))
if(mean(ifelse(ifelse(delta_mu(X)>=0, 1,0)==1, df_complete$Y.1, df_complete$Y.0))>
mean(ifelse(ifelse(delta_mu(X)>0, 1,0) ==1, df_complete$Y.1, df_complete$Y.0))){
pi_opt <- ifelse(delta_mu(X)>=0, 1,0)
}else{
pi_opt <- ifelse(delta_mu(X)>0, 1,0)
}
opt_rule_value <- NULL #mean(ifelse(pi_opt==1,Y.1,Y.0 ))
opt_rule_constraint <- NULL #mean(pi_opt*delta_nu(X)) -alpha
root.path_6000 <- paste0(6*1e3,"_results_", scenario_mu,"-",scenario_nu)
folder_6000 <- file.path(root.path_6000, "Binary")
all_files_6000 <- file.path(root.path_6000, "Binary",list.files(folder_6000, pattern="^\\d+_ev"))
policy_value_data_3000 <- extract_results("Policy value",all_files_3000, 3000)
cols <- colnames(policy_value_data_3000)
policy_value_data_6000 <- extract_results("Policy value",all_files_6000, 6000) %>%
mutate(BR.O = NA) %>%
select(all_of(cols))
)
policy_value_data_bin <- bind_rows(policy_value_data_3000, policy_value_data_6000)
policy_value_long_bin <- policy_value_data_bin %>%
pivot_longer(cols = cols[cols!="Size"],
names_to = "Method",
values_to = "Value")%>%
mutate(Method=factor(Method, levels = cols[cols!="Size"]))
ref_val_policy <- policy_value_long_bin$Value[!is.na(policy_value_long_bin$Value)]
plot_policy_value_bin <- ggplot(policy_value_long_bin, aes(x = as.factor(Size), y = Value, fill = Method)) +
geom_violin(alpha = 0.4, color = NA, trim = FALSE, scale = "width",
position = position_dodge(width = 0.9), na.rm = TRUE) +   # smooth violin with fill
geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.9), na.rm = TRUE)+
geom_hline(yintercept = opt_rule_value, linetype = "dashed", color = "red") +
coord_cartesian(ylim = c(y_min, y_max))+
labs(x = "Sample size (n)", y = "Policy Values", fill = "Method"
#, title="Policy value by sample size and method"
) +
theme_minimal()
plot_policy_value_bin
p_pv <- gridExtra::grid.arrange(plot_policy_value, plot_policy_value_bin, ncol=2)
constraint_data_3000 <- extract_results("Constraint", all_files_3000, 3000)
constraint_data_6000 <- extract_results("Constraint", all_files_6000, 6000)%>%
mutate(BR.O = NA) %>%
select(all_of(cols))
constraint_data_bin <- bind_rows(constraint_data_3000, constraint_data_6000)
constraint_long_bin <- constraint_data_bin %>%
pivot_longer(cols = cols[cols!="Size"],names_to = "Method", values_to = "Value")%>%
mutate(Method=factor(Method, levels = cols[cols!="Size"])) %>%
group_by(Size, Method) %>%
mutate(var_val = var(Value, na.rm = TRUE)) %>%
ungroup()
ref_val_constraint <- constraint_long_bin$Value[!is.na(constraint_long_bin$Value)]
plot_constraint_bin <- ggplot(constraint_long_bin, aes(x = as.factor(Size), y = Value, fill = Method)) +
geom_violin(data = subset(constraint_long_bin, var_val > 0), alpha = 0.4, color = NA, trim = FALSE, scale = "width",
position = position_dodge(width = 0.9), na.rm = TRUE) +   # smooth violin with fill
geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.9), na.rm = TRUE)+
geom_hline(yintercept = opt_rule_constraint, linetype = "dashed", color = "red") +
labs(x = "Sample size (n)", y = "Constraint Values", fill = "Method"
#, title = "Constraint by sample size and method"
) +
coord_cartesian(ylim = c(c_min, c_max))+
theme_minimal()
plot_constraint_bin
c_min <- -0.1
c_max <- 0.1
plot_constraint_bin <- ggplot(constraint_long_bin, aes(x = as.factor(Size), y = Value, fill = Method)) +
geom_violin(data = subset(constraint_long_bin, var_val > 0), alpha = 0.4, color = NA, trim = FALSE, scale = "width",
position = position_dodge(width = 0.9), na.rm = TRUE) +   # smooth violin with fill
geom_boxplot(width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.9), na.rm = TRUE)+
geom_hline(yintercept = opt_rule_constraint, linetype = "dashed", color = "red") +
labs(x = "Sample size (n)", y = "Constraint Values", fill = "Method"
#, title = "Constraint by sample size and method"
) +
coord_cartesian(ylim = c(c_min, c_max))+
theme_minimal()
plot_constraint <- ggplot(constraint_long, aes(x = factor(Size), y = constraint, fill = Method)) +
geom_violin(data = subset(constraint_long, var_val > 0),
scale = "width",
alpha = 0.4, color = NA, trim = FALSE,
position = position_dodge(width = 0.8)) +
geom_boxplot(aes(group = interaction(Size, Method)),
width = 0.1, outlier.shape = NA, alpha = 0.8,
position = position_dodge(width = 0.8)) +
labs(#title = "Constraint values",
x = "Sample size (n)",
y = "Constraint values") +
coord_cartesian(ylim = c(c_min, c_max))+
theme_minimal()
p_constraint <- gridExtra::grid.arrange(plot_constraint, plot_constraint_bin, ncol=2)
t <- readRDS("3000_results_Linear-Linear/Theta_opt/1_Naive_approach.rds")
tc <- readRDS("3000_results_Linear-Linear/Theta_opt/1_0_5.rds")
to <- readRDS("3000_results_Linear-Linear/Theta_opt/1_Oracular_approach.rds")
readRDS("3000_results_Linear-Linear/Evaluation/1_0_5.rds")
readRDS("3000_results_Linear-Linear/MC_metrics/")
readRDS("3000_results_Linear-Linear/MC_metrics/1_Metrics.rds")
readRDS("3000_results_Linear-Linear/MC_metrics/2_Metrics.rds")
p_constraint
p_constraint <- gridExtra::grid.arrange(plot_constraint, plot_constraint_bin, ncol=2)
setwd("~/Documents/PhD/Project 1 - Policy learning - Constraints - Multiple outcome/PLUCR_package")
devtools::document("PLUCR/")
devtools::document("PLUCR/")
devtools::build("PLUCR/")
devtools::install("PLUCR/")
devtools::document("PLUCR/")
devtools::install("PLUCR/")
devtools::build("PLUCR/")
devtools::install("PLUCR/")
devtools::document("PLUCR/")
devtools::build("PLUCR/")
devtools::install("PLUCR/")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
echo = TRUE,        # show code
message = TRUE,     # show messages from code
warning = TRUE      # show warnings from code
)
devtools::install_github("laufuentes/PLUCR")
